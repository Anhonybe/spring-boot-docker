<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CRUD de Productos con Spring Boot</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1, h2 { color: #2c3e50; }
        form, .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        input[type="text"], input[type="number"] { padding: 8px; margin: 5px 0; display: block; width: 300px; }
        button { padding: 10px 15px; background-color: #3498db; color: white; border: none; border-radius: 3px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #2980b9; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        .edit-btn, .delete-btn { background-color: #e74c3c; margin-right: 0; }
        .edit-btn { background-color: #f39c12; }
    </style>
</head>
<body>

    <h1>Administrador de Productos (Spring Boot + MySQL)</h1>

    <div class="section">
        <h2>Crear Nuevo Producto</h2>
        <form id="formularioCrear">
            <label for="nombreCrear">Nombre:</label>
            <input type="text" id="nombreCrear" required>
            
            <label for="precioCrear">Precio:</label>
            <input type="number" id="precioCrear" step="0.01" required>
            
            <label for="stockCrear">Stock:</label>
            <input type="number" id="stockCrear" required>
            
            <button type="submit">âž• Guardar Producto</button>
        </form>
    </div>
    
    <div class="section">
        <h2>Listado de Productos</h2>
        <button onclick="listarProductos()">ðŸ”„ Recargar Lista</button>
        <table id="tablaProductos">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

    <div class="section" id="seccionActualizar" style="display: none;">
        <h2>Actualizar Producto</h2>
        <form id="formularioActualizar">
            <input type="hidden" id="idActualizar">
            
            <label for="nombreActualizar">Nombre:</label>
            <input type="text" id="nombreActualizar" required>
            
            <label for="precioActualizar">Precio:</label>
            <input type="number" id="precioActualizar" step="0.01" required>
            
            <label for="stockActualizar">Stock:</label>
            <input type="number" id="stockActualizar" required>
            
            <button type="submit">ðŸ’¾ Guardar Cambios</button>
            <button type="button" onclick="document.getElementById('seccionActualizar').style.display = 'none'">Cancelar</button>
        </form>
    </div>
    
    <script>
        // La URL de tu API de Spring Boot (AsegÃºrate que el puerto 8080 estÃ© corriendo)
        const API_URL = 'http://localhost:8080/productos';

        document.addEventListener('DOMContentLoaded', () => {
            listarProductos();
            document.getElementById('formularioCrear').addEventListener('submit', crearProducto);
            document.getElementById('formularioActualizar').addEventListener('submit', actualizarProducto);
        });

        // ----------------------------------------------------
        // C - CREATE (POST)
        // ----------------------------------------------------
        async function crearProducto(e) {
            e.preventDefault();
            
            const nombre = document.getElementById('nombreCrear').value;
            const precio = parseFloat(document.getElementById('precioCrear').value);
            const stock = parseInt(document.getElementById('stockCrear').value);
            
            const producto = { nombre, precio, stock };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(producto),
                });

                if (response.ok) {
                    alert('Producto creado exitosamente!');
                    document.getElementById('formularioCrear').reset();
                    listarProductos();
                } else {
                    alert('Error al crear el producto: ' + response.statusText);
                }
            } catch (error) {
                console.error('Error de red:', error);
                alert('No se pudo conectar al servidor. Â¿Spring Boot estÃ¡ corriendo?');
            }
        }

        // ----------------------------------------------------
        // R - READ (GET)
        // ----------------------------------------------------
        async function listarProductos() {
            const tbody = document.getElementById('tablaProductos').querySelector('tbody');
            tbody.innerHTML = '<tr><td colspan="5">Cargando...</td></tr>';

            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error('No se pudo obtener la lista de productos.');
                }
                const productos = await response.json();
                
                tbody.innerHTML = ''; // Limpiar la tabla
                
                if (productos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5">No hay productos en la base de datos.</td></tr>';
                    return;
                }

                productos.forEach(p => {
                    const tr = tbody.insertRow();
                    tr.insertCell().textContent = p.id;
                    tr.insertCell().textContent = p.nombre;
                    tr.insertCell().textContent = p.precio.toFixed(2);
                    tr.insertCell().textContent = p.stock;

                    const accionesCell = tr.insertCell();
                    
                    // BotÃ³n Editar
                    const btnEditar = document.createElement('button');
                    btnEditar.textContent = 'âœï¸ Editar';
                    btnEditar.className = 'edit-btn';
                    btnEditar.onclick = () => cargarParaActualizar(p.id);
                    accionesCell.appendChild(btnEditar);

                    // BotÃ³n Eliminar
                    const btnEliminar = document.createElement('button');
                    btnEliminar.textContent = 'âŒ Eliminar';
                    btnEliminar.className = 'delete-btn';
                    btnEliminar.onclick = () => eliminarProducto(p.id);
                    accionesCell.appendChild(btnEliminar);
                });

            } catch (error) {
                console.error('Error al listar:', error);
                tbody.innerHTML = `<tr><td colspan="5">Error: ${error.message}. AsegÃºrate de que el servidor estÃ© activo.</td></tr>`;
            }
        }
        
        // FunciÃ³n auxiliar para cargar datos en el formulario de actualizaciÃ³n
        async function cargarParaActualizar(id) {
            try {
                const response = await fetch(`${API_URL}/${id}`);
                const p = await response.json();
                
                document.getElementById('idActualizar').value = p.id;
                document.getElementById('nombreActualizar').value = p.nombre;
                document.getElementById('precioActualizar').value = p.precio;
                document.getElementById('stockActualizar').value = p.stock;
                
                // Mostrar el formulario de actualizaciÃ³n
                document.getElementById('seccionActualizar').style.display = 'block';

            } catch (error) {
                alert('Error al cargar datos para actualizar.');
            }
        }

        // ----------------------------------------------------
        // U - UPDATE (PUT)
        // ----------------------------------------------------
        async function actualizarProducto(e) {
            e.preventDefault();
            
            const id = document.getElementById('idActualizar').value;
            const nombre = document.getElementById('nombreActualizar').value;
            const precio = parseFloat(document.getElementById('precioActualizar').value);
            const stock = parseInt(document.getElementById('stockActualizar').value);
            
            const producto = { nombre, precio, stock };

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(producto),
                });

                if (response.ok) {
                    alert('Producto actualizado exitosamente!');
                    document.getElementById('seccionActualizar').style.display = 'none'; // Ocultar formulario
                    listarProductos();
                } else {
                    alert('Error al actualizar el producto: ' + response.statusText);
                }
            } catch (error) {
                console.error('Error de red:', error);
                alert('No se pudo conectar al servidor.');
            }
        }
        
        // ----------------------------------------------------
        // D - DELETE (DELETE)
        // ----------------------------------------------------
        async function eliminarProducto(id) {
            if (!confirm(`Â¿EstÃ¡s seguro de que quieres eliminar el producto con ID: ${id}?`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    alert('Producto eliminado con Ã©xito.');
                    listarProductos();
                } else {
                    alert('Error al eliminar el producto.');
                }
            } catch (error) {
                console.error('Error de red:', error);
                alert('No se pudo conectar al servidor.');
            }
        }
    </script>
</body>
</html>